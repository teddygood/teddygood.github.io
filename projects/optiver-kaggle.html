<!doctype html>
<html lang="ko-KR" dir="ltr" class="plugin-blog plugin-id-projects" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Optiver &quot;Trading at the Close&quot; 대회 @ Chanho Lee</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://teddygood.github.io/projects/optiver-kaggle"><meta data-rh="true" property="og:locale" content="ko_KR"><meta data-rh="true" property="og:locale:alternate" content="en"><meta data-rh="true" name="docusaurus_locale" content="ko"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="ko"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Optiver &quot;Trading at the Close&quot; 대회 @ Chanho Lee"><meta data-rh="true" name="description" content="Kaggle Optiver - Trading at the Close 대회 회고 (Bronze Medal, Top 30%)"><meta data-rh="true" property="og:description" content="Kaggle Optiver - Trading at the Close 대회 회고 (Bronze Medal, Top 30%)"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://teddygood.github.io/projects/optiver-kaggle"><link data-rh="true" rel="alternate" href="https://teddygood.github.io/projects/optiver-kaggle" hreflang="ko-KR"><link data-rh="true" rel="alternate" href="https://teddygood.github.io/en/projects/optiver-kaggle" hreflang="en"><link data-rh="true" rel="alternate" href="https://teddygood.github.io/projects/optiver-kaggle" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://3GO7VFCZS7-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Chanho Lee RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Chanho Lee Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-EFT0SBFJCH"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-EFT0SBFJCH",{})</script>



<link rel="search" type="application/opensearchdescription+xml" title="Chanho Lee" href="/opensearch.xml">
<link rel="alternate" type="application/rss+xml" href="/projects/rss.xml" title="Chanho Lee Projects RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/projects/atom.xml" title="Chanho Lee Projects Atom Feed">
<link rel="alternate" type="application/json" href="/projects/feed.json" title="Chanho Lee Projects JSON Feed">
<link rel="stylesheet" href="/katex/katex.min.css"><link rel="stylesheet" href="/assets/css/styles.1c83aca9.css">
<script src="/assets/js/runtime~main.97f45e2e.js" defer="defer"></script>
<script src="/assets/js/main.d6a27a84.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"light"),document.documentElement.setAttribute("data-theme-choice",t||"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="본문으로 건너뛰기"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">본문으로 건너뛰기</a></div><nav aria-label="메인" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="사이드바 펼치거나 접기" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo-new.png" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo-new.png" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Chanho Lee</b></a><a class="navbar__item navbar__link" href="/wiki/introduction">Wiki</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/projects">Projects</a><a class="navbar__item navbar__link" href="/blog/archive">Archive</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>한국어</a><ul class="dropdown__menu"><li><a href="/projects/optiver-kaggle" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="ko-KR">한국어</a></li><li><a href="/en/projects/optiver-kaggle" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en">English</a></li></ul></div><a href="https://github.com/teddygood" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><a href="https://www.linkedin.com/in/teddygood/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-linkedin-link" aria-label="LinkedIn Account"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="어두운 모드와 밝은 모드 전환하기 (현재 system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="검색 (Meta+k)" aria-keyshortcuts="Meta+k"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 24 24" aria-hidden="true"><circle cx="11" cy="11" r="8" stroke="currentColor" fill="none" stroke-width="1.4"></circle><path d="m21 21-4.3-4.3" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">검색</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div style="max-width:800px;margin:0 auto"><h1 style="font-size:3rem;margin-bottom:2rem">Optiver &quot;Trading at the Close&quot; 대회</h1><div class="row margin-bottom--lg"><div class="col col--4"><h4 class="text--uppercase" style="margin-bottom:0.25rem;color:var(--ifm-color-emphasis-600);font-size:0.8rem">Role</h4><p style="font-weight:bold;font-size:1.1rem">Data Scientist</p></div><div class="col col--4"><h4 class="text--uppercase" style="margin-bottom:0.25rem;color:var(--ifm-color-emphasis-600);font-size:0.8rem">Timeline</h4><p style="font-weight:bold;font-size:1.1rem">Oct 2023 - Dec 2023</p></div><div class="col col--4"><h4 class="text--uppercase" style="margin-bottom:0.25rem;color:var(--ifm-color-emphasis-600);font-size:0.8rem">Skill</h4><div style="display:flex;gap:0.5rem;flex-wrap:wrap"><span class="badge badge--secondary">Python</span><span class="badge badge--secondary">LightGBM</span><span class="badge badge--secondary">Numba</span><span class="badge badge--secondary">Pandas</span></div></div></div><hr style="margin-bottom:2rem"><h2 id="시작하게-된-계기">시작하게 된 계기</h2>
<p>2023년, Google ML 부트캠프 4기에 참여하면서 수료 조건 중 하나로 캐글 대회 참가가 있었다. 마침 Optiver가 &quot;Trading at the Close&quot;라는 대회를 열었고, 종가 경매(closing auction)라는 생소하지만 흥미로운 도메인이라 선택했다. 최종 제출물은 <code>my-submission.ipynb</code>에 정리한 LightGBM 기반 파이프라인이다.</p>
<hr>
<h2 id="대회-개요">대회 개요</h2>
<h3 id="optiver와-종가-경매">Optiver와 종가 경매</h3>
<p>Optiver는 글로벌 전자 마켓메이커다. 파생상품, 주식, ETF, 채권, 외환 등을 거래하면서 전 세계 주요 거래소에 유동성을 공급한다.</p>
<p>**나스닥 종가 경매(Nasdaq Closing Cross)**는 매일 장 마감 10분(3:50~4:00 PM ET) 동안 진행되며, 이 시간에 그 날의 공식 종가가 결정된다. 투자자들이 포지션을 조정하면서 변동성이 크고, 전통적인 호가창 데이터와 경매 데이터를 동시에 처리해야 하는 복잡한 구간이다.</p>
<h3 id="대회-일정과-상금">대회 일정과 상금</h3>
<ul>
<li><strong>시작</strong>: 2023년 9월 20일</li>
<li><strong>최종 제출</strong>: 2023년 12월 20일</li>
<li><strong>Forecasting 기간</strong>: 2023년 12월 20일 ~ 2024년 3월 20일 (실시간 시장 데이터로 평가)</li>
<li><strong>총 상금</strong>: <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>100</mn><mo separator="true">,</mo><mn>000</mn><mo stretchy="false">(</mo><mn>1</mn><mtext>위</mtext></mrow><annotation encoding="application/x-tex">100,000 (1위 </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord">100</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord">000</span><span class="mopen">(</span><span class="mord">1</span><span class="mord hangul_fallback">위</span></span></span></span>25,000)</li>
</ul>
<p>이 대회는 일반적인 캐글 대회와 달리, 제출 후 약 3개월간 실제 시장 데이터로 모델이 평가되는 <strong>forecasting 대회</strong>였다. 리더보드가 2주마다 갱신되었고, 매일 <code>revealed_targets</code>로 전날의 정답이 공개됐다.</p>
<h3 id="문제-정의">문제 정의</h3>
<p>종가 경매 구간에서 60초 뒤의 주가 움직임을 예측하는 게 과제다.</p>
<h3 id="타깃-정의">타깃 정의</h3>
<p>타깃은 개별 종목의 WAP(가중평균가격) 변화에서 지수 WAP 변화를 뺀 값으로, basis points(bp, 0.01%) 단위로 표현된다:</p>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>T</mi><mi>a</mi><mi>r</mi><mi>g</mi><mi>e</mi><mi>t</mi><mo>=</mo><mrow><mo fence="true">(</mo><mfrac><mrow><mi>S</mi><mi>t</mi><mi>o</mi><mi>c</mi><mi>k</mi><mi>W</mi><mi>A</mi><msub><mi>P</mi><mrow><mi>t</mi><mo>+</mo><mn>60</mn></mrow></msub></mrow><mrow><mi>S</mi><mi>t</mi><mi>o</mi><mi>c</mi><mi>k</mi><mi>W</mi><mi>A</mi><msub><mi>P</mi><mi>t</mi></msub></mrow></mfrac><mo>−</mo><mfrac><mrow><mi>I</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>x</mi><mi>W</mi><mi>A</mi><msub><mi>P</mi><mrow><mi>t</mi><mo>+</mo><mn>60</mn></mrow></msub></mrow><mrow><mi>I</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>x</mi><mi>W</mi><mi>A</mi><msub><mi>P</mi><mi>t</mi></msub></mrow></mfrac><mo fence="true">)</mo></mrow><mo>×</mo><mn>10000</mn></mrow><annotation encoding="application/x-tex">Target = \left( \frac{StockWAP_{t+60}}{StockWAP_t} - \frac{IndexWAP_{t+60}}{IndexWAP_t} \right) \times 10000</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em"></span><span class="mord mathnormal" style="margin-right:0.13889em">T</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal" style="margin-right:0.03588em">g</span><span class="mord mathnormal">e</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:2.4em;vertical-align:-0.95em"></span><span class="minner"><span class="mopen delimcenter" style="top:0em"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em"><span style="top:-2.314em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord mathnormal">St</span><span class="mord mathnormal">oc</span><span class="mord mathnormal" style="margin-right:0.13889em">kW</span><span class="mord mathnormal">A</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:0.04em"></span></span><span style="top:-3.677em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord mathnormal">St</span><span class="mord mathnormal">oc</span><span class="mord mathnormal" style="margin-right:0.13889em">kW</span><span class="mord mathnormal">A</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">60</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.836em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em"><span style="top:-2.314em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em">I</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mord mathnormal" style="margin-right:0.13889em">W</span><span class="mord mathnormal">A</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:0.04em"></span></span><span style="top:-3.677em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em">I</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mord mathnormal" style="margin-right:0.13889em">W</span><span class="mord mathnormal">A</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">60</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.836em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em"><span class="delimsizing size3">)</span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">10000</span></span></span></span></span>
<p>즉, 시장 전체의 움직임을 제거한 개별 종목의 &quot;상대적&quot; 가격 변화를 맞추는 문제다.</p>
<h3 id="평가-지표">평가 지표</h3>
<p>Mean Absolute Error (MAE):</p>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>M</mi><mi>A</mi><mi>E</mi><mo>=</mo><mfrac><mn>1</mn><mi>n</mi></mfrac><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mi mathvariant="normal">∣</mi><msub><mi>y</mi><mi>i</mi></msub><mo>−</mo><msub><mi>x</mi><mi>i</mi></msub><mi mathvariant="normal">∣</mi></mrow><annotation encoding="application/x-tex">MAE = \frac{1}{n} \sum_{i=1}^{n} |y_i - x_i|</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal" style="margin-right:0.10903em">M</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.05764em">E</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:2.9291em;vertical-align:-1.2777em"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em"><span style="top:-2.314em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord mathnormal">n</span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:0.04em"></span></span><span style="top:-3.677em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.1667em"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6514em"><span style="top:-1.8723em;margin-left:0em"><span class="pstrut" style="height:3.05em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em"><span class="pstrut" style="height:3.05em"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em"><span class="pstrut" style="height:3.05em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2777em"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord">∣</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mord">∣</span></span></span></span></span>
<h3 id="데이터-구조">데이터 구조</h3>
<p>학습 데이터는 481일간 약 200개 종목의 종가 경매 스냅샷으로, 약 500만 행 규모다. 주요 컬럼은 다음과 같다:</p>
<table><thead><tr><th>컬럼</th><th>설명</th></tr></thead><tbody><tr><td><code>stock_id</code></td><td>종목 고유 식별자</td></tr><tr><td><code>date_id</code></td><td>날짜 식별자 (순차적)</td></tr><tr><td><code>seconds_in_bucket</code></td><td>경매 시작 후 경과 시간 (초)</td></tr><tr><td><code>imbalance_size</code></td><td>현재 reference_price에서 매칭되지 않은 물량 (USD)</td></tr><tr><td><code>imbalance_buy_sell_flag</code></td><td>불균형 방향: 1(매수 초과), -1(매도 초과), 0(없음)</td></tr><tr><td><code>reference_price</code></td><td>매칭 수량이 최대가 되는 가격</td></tr><tr><td><code>matched_size</code></td><td>현재 reference_price에서 매칭 가능한 물량 (USD)</td></tr><tr><td><code>far_price</code> / <code>near_price</code></td><td>경매 주문만/연속 주문 포함 시 최적 체결가</td></tr><tr><td><code>bid_price</code> / <code>ask_price</code></td><td>비경매 호가창의 최우선 매수/매도 가격</td></tr><tr><td><code>bid_size</code> / <code>ask_size</code></td><td>최우선 호가의 물량 (USD)</td></tr><tr><td><code>wap</code></td><td>비경매 호가창의 가중평균가격: <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>B</mi><mi>i</mi><mi>d</mi><mi>P</mi><mo>×</mo><mi>A</mi><mi>s</mi><mi>k</mi><mi>S</mi><mo>+</mo><mi>A</mi><mi>s</mi><mi>k</mi><mi>P</mi><mo>×</mo><mi>B</mi><mi>i</mi><mi>d</mi><mi>S</mi><mo stretchy="false">)</mo><mi mathvariant="normal">/</mi><mo stretchy="false">(</mo><mi>B</mi><mi>i</mi><mi>d</mi><mi>S</mi><mo>+</mo><mi>A</mi><mi>s</mi><mi>k</mi><mi>S</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(BidP \times AskS + AskP \times BidS) / (BidS + AskS)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05017em">B</span><span class="mord mathnormal">i</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.13889em">P</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.0833em"></span><span class="mord mathnormal">A</span><span class="mord mathnormal">s</span><span class="mord mathnormal" style="margin-right:0.03148em">k</span><span class="mord mathnormal" style="margin-right:0.05764em">S</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.0833em"></span><span class="mord mathnormal">A</span><span class="mord mathnormal">s</span><span class="mord mathnormal" style="margin-right:0.03148em">k</span><span class="mord mathnormal" style="margin-right:0.13889em">P</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal" style="margin-right:0.05017em">B</span><span class="mord mathnormal">i</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.05764em">S</span><span class="mclose">)</span><span class="mord">/</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05017em">B</span><span class="mord mathnormal">i</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.05764em">S</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal">A</span><span class="mord mathnormal">s</span><span class="mord mathnormal" style="margin-right:0.03148em">k</span><span class="mord mathnormal" style="margin-right:0.05764em">S</span><span class="mclose">)</span></span></span></span></td></tr></tbody></table>
<hr>
<h2 id="내-접근-방식">내 접근 방식</h2>
<h3 id="피처-엔지니어링">피처 엔지니어링</h3>
<p><code>my-submission.ipynb</code>에서 총 124개의 피처를 사용했다. 크게 다섯 가지 카테고리로 나눌 수 있다:</p>
<p><strong>1. 유동성/불균형 피처</strong></p>
<ul>
<li><code>liquidity_imbalance</code>: 호가 물량 불균형 → <code>(bid_size - ask_size) / (bid_size + ask_size)</code></li>
<li><code>matched_imbalance</code>: 매칭/불균형 물량 비율 → <code>(imbalance_size - matched_size) / (imbalance_size + matched_size)</code></li>
<li><code>size_imbalance</code>: 단순 비율 → <code>bid_size / ask_size</code></li>
<li><code>imbalance_momentum</code>: 종목별 <code>imbalance_size</code>의 시간 변화를 <code>matched_size</code>로 나눈 값</li>
</ul>
<p><strong>2. 가격 스프레드 피처</strong></p>
<ul>
<li><code>price_spread</code>: <code>ask_price - bid_price</code></li>
<li><code>spread_intensity</code>: 종목별 스프레드 변화량</li>
<li><code>price_pressure</code>: <code>imbalance_size * price_spread</code></li>
<li><code>market_urgency</code>: <code>price_spread * liquidity_imbalance</code></li>
</ul>
<p><strong>3. 가격 쌍/삼중 비율 피처</strong></p>
<ul>
<li>6개 가격(<code>reference_price</code>, <code>far_price</code>, <code>near_price</code>, <code>ask_price</code>, <code>bid_price</code>, <code>wap</code>)의 모든 쌍 조합으로 imbalance 비율 계산 → <code>(P1 - P2) / (P1 + P2)</code> 형태</li>
<li>Numba로 가속한 triplet imbalance: 세 가격의 (max - mid) / (mid - min) 비율</li>
</ul>
<p><strong>4. 시계열 피처</strong></p>
<ul>
<li><code>matched_size</code>, <code>imbalance_size</code>, <code>reference_price</code>, <code>imbalance_buy_sell_flag</code>의 1/2/3/10 래그와 pct_change</li>
<li><code>ask_price</code>, <code>bid_price</code>, <code>ask_size</code>, <code>bid_size</code>, <code>market_urgency</code>, <code>imbalance_momentum</code>, <code>size_imbalance</code>의 1/2/3/10 diff</li>
</ul>
<p><strong>5. 전역 통계 피처</strong></p>
<ul>
<li>종목별 <code>bid_size</code>, <code>ask_size</code>, <code>bid_price</code>, <code>ask_price</code>의 median, std, ptp(peak-to-peak)를 계산해 <code>global_*</code> 형태로 매핑</li>
<li>시간 파생: <code>dow</code>(요일), <code>seconds</code>, <code>minute</code></li>
</ul>
<h3 id="모델과-학습">모델과 학습</h3>
<ul>
<li><strong>모델</strong>: LightGBM (<code>objective=&#x27;mae&#x27;</code>, <strong>Tesla P100 GPU</strong>)</li>
<li><strong>하이퍼파라미터</strong>: n_estimators=6000, num_leaves=256, max_depth=11, learning_rate=0.00871, subsample=0.6, colsample_bytree=0.8</li>
<li><strong>검증</strong>: 날짜 기준 5-fold CV, 각 fold 사이에 5일 purge gap 적용 (시간 누수 방지)</li>
<li><strong>최종 학습</strong>: 5개 fold의 평균 best_iteration(약 5103)으로 전체 데이터 재학습</li>
</ul>
<h3 id="추론">추론</h3>
<ul>
<li>종목별 최근 21행을 롤링 캐시로 유지하면서 피처 생성</li>
<li>5개 fold 모델의 equal-weight 앙상블</li>
<li><code>zero_sum</code> 후처리: 예측값에서 <strong>거래량(bid+ask size)의 제곱근</strong>을 가중치로 써서 가중 평균을 뺀다. 시장 전체의 합이 0이 되도록 맞추는 과정이다.</li>
<li>클리핑: [-64, 64] 범위로 제한</li>
</ul>
<hr>
<h2 id="결과">결과</h2>
<table><thead><tr><th>항목</th><th>값</th></tr></thead><tbody><tr><td>5-fold CV MAE</td><td>5.83 (fold별: 6.75, 6.12, 5.97, 5.49, 4.80)</td></tr><tr><td>Public/Private LB</td><td>5.4744</td></tr><tr><td>순위</td><td>981위 / 3,225팀 (Top 30%)</td></tr><tr><td>실행 시간</td><td>2시간 35분 (P100 GPU)</td></tr><tr><td>추론 속도</td><td>배치당 ~0.34초</td></tr></tbody></table>
<hr>
<h2 id="상위-솔루션과-비교">상위 솔루션과 비교</h2>
<p>대회가 끝나고 상위권 솔루션들을 살펴봤다. 내가 놓친 부분이 무엇인지 정리해봤다.</p>
<h3 id="1위--hyd-hydantess">1위 – HYD (hydantess)</h3>
<ul>
<li><strong>모델</strong>: CatBoost(50%) + GRU(30%) + Transformer(20%) 앙상블</li>
<li><strong>특징</strong>: GRU는 55개 타임스텝의 시계열 패턴을, Transformer는 200개 종목 간 cross-sectional 관계를 포착</li>
<li><strong>온라인 학습</strong>: 12일마다 재학습 (총 4회)</li>
<li><strong>가중 zero_sum</strong>: <code>pred -= (pred * stock_weights).sum() / stock_weights.sum()</code></li>
<li><strong>샘플 가중치</strong>: <code>1.0 / (stock_std + 1e-7)</code>로 종목별 변동성 정규화</li>
</ul>
<h3 id="9위--adam-hookman">9위 – ADAM. (hookman)</h3>
<ul>
<li><strong>모델</strong>: 3× XGBoost (다른 시드)</li>
<li><strong>피처</strong>: 157개, median-scaled 물량, MACD, WAP 기반 타깃 프록시</li>
<li><strong>데이터 가중치</strong>: 최근 45일에 1.5배 가중치</li>
<li><strong>온라인 학습</strong>: Day N, Day N+30에 재학습</li>
</ul>
<h3 id="14위--clash-royale-5인-팀">14위 – Clash Royale (5인 팀)</h3>
<ul>
<li><strong>모델</strong>: LightGBM + CatBoost 단순 평균</li>
<li><strong>피처</strong>: 193개, revealed target 래그, RSI/MACD/Bollinger Bands</li>
<li><strong>온라인 학습</strong>: 6~9일마다 LGB/CAT 교대 재학습</li>
<li><strong>핵심 수정</strong>: <code>mid_price_movement</code> 계산 시 <code>stock_id</code> 그룹화로 누수 수정</li>
</ul>
<h3 id="15위--o-yuksel-lognorm">15위 – O Yuksel (lognorm)</h3>
<ul>
<li><strong>모델</strong>: 3× LGB(오프라인) + 4× XGB + 1× LGB(온라인)</li>
<li><strong>피처</strong>: revealed target, 시장/섹터 대비 상대 성과, stock_id 대신 행동 기반 임베딩</li>
<li><strong>후처리</strong>: 단순 zero-sum 대신 index-weighted mean 차감</li>
</ul>
<h3 id="공통점과-내가-놓친-것들">공통점과 내가 놓친 것들</h3>
<table><thead><tr><th>상위권 특징</th><th>내 솔루션</th></tr></thead><tbody><tr><td><strong>온라인 학습</strong> (6~30일마다 재학습)</td><td>한 번 학습 후 고정</td></tr><tr><td><strong>다중 모델 앙상블</strong> (LGB+CAT+XGB 또는 +GRU/Transformer)</td><td>LightGBM 단일</td></tr><tr><td><strong>종목별 스케일링</strong> (stock_std, median)</td><td>전역 통계만 사용</td></tr><tr><td><strong>가중 zero_sum</strong></td><td>단순 거래량 제곱근 가중치 사용</td></tr><tr><td><strong>revealed target 피처</strong></td><td>사용 안 함</td></tr><tr><td><strong>시드 다양성</strong> (같은 모델 3개 이상)</td><td>5-fold 앙상블만</td></tr></tbody></table>
<hr>
<h2 id="회고">회고</h2>
<h3 id="잘한-점">잘한 점</h3>
<ul>
<li>Numba로 triplet imbalance를 가속해서 피처 생성 시간을 줄였다</li>
<li>날짜 기반 purge gap으로 시간 누수를 억제했다</li>
<li>메모리 다운캐스팅으로 Kaggle 환경에서도 안정적으로 돌았다</li>
</ul>
<h3 id="아쉬운-점">아쉬운 점</h3>
<ul>
<li><strong>온라인 학습을 안 했다.</strong> 이 대회는 API가 매일 장 시작 때 <strong>전날의 정답(<code>revealed_targets</code>)을 제공</strong>해준다. 상위권들은 이 데이터를 버리지 않고 모델을 주기적으로 재학습(retrain)시켜서 시장의 최신 트렌드를 반영했다. 나는 모델을 한 번 학습시키고 3개월 내내 그대로 둬서 drift에 대응하지 못했다.</li>
<li><strong>시퀀스 모델을 안 붙였다.</strong> 1위 솔루션은 GRU로 시간 순서, Transformer로 종목 간 관계를 포착했다. 트리 모델만으로는 이런 구조적 패턴을 잡기 어려웠을 것이다.</li>
<li><strong>종목별 정규화가 없었다.</strong> stock_std나 median으로 스케일링했으면 종목 간 변동성 차이를 보정할 수 있었다.</li>
<li>Google ML Bootcamp 수료를 목적으로 한 프로젝트이기에 대회가 끝날 때까지 끊기있게 하지 않았다. 좀 더 노력을 했으면 더 높은 점수도 받을 수 있지 않았을까 싶다.</li>
</ul>
<hr>
<h2 id="참고-자료">참고 자료</h2>
<ul>
<li><a href="https://www.kaggle.com/competitions/optiver-trading-at-the-close/writeups/hyd-1st-place-solution">1st place – HYD</a></li>
<li><a href="https://www.kaggle.com/competitions/optiver-trading-at-the-close/writeups/adam-9th-place-solution">9th place – ADAM.</a></li>
<li><a href="https://www.kaggle.com/competitions/optiver-trading-at-the-close/writeups/clash-royale-14th-place-solution-for-the-optiver-t">14th place – Clash Royale</a></li>
<li><a href="https://www.kaggle.com/competitions/optiver-trading-at-the-close/writeups/o-yuksel-15th-place-solution">15th place – O Yuksel</a></li>
<li><a href="https://www.kaggle.com/competitions/optiver-trading-at-the-close/data">Kaggle Data Page</a></li>
</ul></div></div></div></div>
</body>
</html>