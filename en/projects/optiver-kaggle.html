<!doctype html>
<html lang="en" dir="ltr" class="plugin-blog plugin-id-projects" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Optiver &quot;Trading at the Close&quot; Competition Retrospective @ Chanho Lee</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://teddygood.github.io/en/projects/optiver-kaggle"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" property="og:locale:alternate" content="ko_KR"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Optiver &quot;Trading at the Close&quot; Competition Retrospective @ Chanho Lee"><meta data-rh="true" name="description" content="Kaggle Optiver - Trading at the Close Retrospective (Bronze Medal, Top 30%)"><meta data-rh="true" property="og:description" content="Kaggle Optiver - Trading at the Close Retrospective (Bronze Medal, Top 30%)"><link data-rh="true" rel="icon" href="/en/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://teddygood.github.io/en/projects/optiver-kaggle"><link data-rh="true" rel="alternate" href="https://teddygood.github.io/projects/optiver-kaggle" hreflang="ko-KR"><link data-rh="true" rel="alternate" href="https://teddygood.github.io/en/projects/optiver-kaggle" hreflang="en"><link data-rh="true" rel="alternate" href="https://teddygood.github.io/projects/optiver-kaggle" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://3GO7VFCZS7-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/en/blog/rss.xml" title="Chanho Lee RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/en/blog/atom.xml" title="Chanho Lee Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-EFT0SBFJCH"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-EFT0SBFJCH",{})</script>



<link rel="search" type="application/opensearchdescription+xml" title="Chanho Lee" href="/en/opensearch.xml">
<link rel="alternate" type="application/rss+xml" href="/en/projects/rss.xml" title="Chanho Lee Projects RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/en/projects/atom.xml" title="Chanho Lee Projects Atom Feed">
<link rel="alternate" type="application/json" href="/en/projects/feed.json" title="Chanho Lee Projects JSON Feed">
<link rel="stylesheet" href="/katex/katex.min.css"><link rel="stylesheet" href="/en/assets/css/styles.f5bd183a.css">
<script src="/en/assets/js/runtime~main.af874fed.js" defer="defer"></script>
<script src="/en/assets/js/main.81ea5d49.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"light"),document.documentElement.setAttribute("data-theme-choice",t||"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/en/"><div class="navbar__logo"><img src="/en/img/logo-new.png" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/en/img/logo-new.png" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Chanho Lee</b></a><a class="navbar__item navbar__link" href="/en/wiki/introduction">Wiki</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/en/projects">Projects</a><a class="navbar__item navbar__link" href="/en/blog/archive">Archive</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/projects/optiver-kaggle" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="ko-KR">한국어</a></li><li><a href="/en/projects/optiver-kaggle" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en">English</a></li></ul></div><a href="https://github.com/teddygood" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><a href="https://www.linkedin.com/in/teddygood/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-linkedin-link" aria-label="LinkedIn Account"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Meta+k)" aria-keyshortcuts="Meta+k"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 24 24" aria-hidden="true"><circle cx="11" cy="11" r="8" stroke="currentColor" fill="none" stroke-width="1.4"></circle><path d="m21 21-4.3-4.3" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div style="max-width:800px;margin:0 auto"><h1 style="font-size:3rem;margin-bottom:2rem">Optiver &quot;Trading at the Close&quot; Competition Retrospective</h1><div class="row margin-bottom--lg"><div class="col col--4"><h4 class="text--uppercase" style="margin-bottom:0.25rem;color:var(--ifm-color-emphasis-600);font-size:0.8rem">Role</h4><p style="font-weight:bold;font-size:1.1rem">Data Scientist</p></div><div class="col col--4"><h4 class="text--uppercase" style="margin-bottom:0.25rem;color:var(--ifm-color-emphasis-600);font-size:0.8rem">Timeline</h4><p style="font-weight:bold;font-size:1.1rem">Oct 2023 - Dec 2023</p></div><div class="col col--4"><h4 class="text--uppercase" style="margin-bottom:0.25rem;color:var(--ifm-color-emphasis-600);font-size:0.8rem">Skill</h4><div style="display:flex;gap:0.5rem;flex-wrap:wrap"><span class="badge badge--secondary">Python</span><span class="badge badge--secondary">LightGBM</span><span class="badge badge--secondary">Numba</span><span class="badge badge--secondary">Pandas</span></div></div></div><hr style="margin-bottom:2rem"><h2 id="motivation">Motivation</h2>
<p>In 2023, while participating in the 4th cohort of the Google ML Bootcamp, one of the completion requirements was to participate in a Kaggle competition. Coincidentally, Optiver was hosting a competition called &quot;Trading at the Close,&quot; and I chose it because the domain of closing auctions was unfamiliar but intriguing. My final submission is a LightGBM-based pipeline documented in <code>my-submission.ipynb</code>.</p>
<hr>
<h2 id="competition-overview">Competition Overview</h2>
<h3 id="optiver-and-closing-auctions">Optiver and Closing Auctions</h3>
<p>Optiver is a global electronic market maker. They provide liquidity to major exchanges worldwide while trading derivatives, equities, ETFs, bonds, and foreign exchange.</p>
<p>The <strong>Nasdaq Closing Cross</strong> takes place daily during the last 10 minutes of the market (3:50–4:00 PM ET), during which the official closing price for the day is determined. It is a complex period where investors adjust positions, leading to high volatility, and requires simultaneous processing of traditional order book data and auction data.</p>
<h3 id="schedule-and-prize">Schedule and Prize</h3>
<ul>
<li><strong>Start</strong>: September 20, 2023</li>
<li><strong>Final Submission</strong>: December 20, 2023</li>
<li><strong>Forecasting Period</strong>: December 20, 2023 – March 20, 2024 (Evaluated on real-time market data)</li>
<li><strong>Total Prize</strong>: <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>100</mn><mo separator="true">,</mo><mn>000</mn><mo stretchy="false">(</mo><mn>1</mn><mi>s</mi><mi>t</mi><mi>P</mi><mi>l</mi><mi>a</mi><mi>c</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">100,000 (1st Place </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord">100</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord">000</span><span class="mopen">(</span><span class="mord">1</span><span class="mord mathnormal">s</span><span class="mord mathnormal" style="margin-right:0.01968em">tPl</span><span class="mord mathnormal">a</span><span class="mord mathnormal">ce</span></span></span></span>25,000)</li>
</ul>
<p>Unlike typical Kaggle competitions, this was a <strong>forecasting competition</strong> where models were evaluated on actual market data for about 3 months after submission. The leaderboard was updated every two weeks, and the previous day&#x27;s answers were released daily via <code>revealed_targets</code>.</p>
<h3 id="problem-definition">Problem Definition</h3>
<p>The task was to predict price movements 60 seconds into the future during the closing auction period.</p>
<h3 id="target-definition">Target Definition</h3>
<p>The target is the change in the WAP (Weighted Average Price) of an individual stock minus the change in the Index WAP, expressed in basis points (bp, 0.01%):</p>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>T</mi><mi>a</mi><mi>r</mi><mi>g</mi><mi>e</mi><mi>t</mi><mo>=</mo><mrow><mo fence="true">(</mo><mfrac><mrow><mi>S</mi><mi>t</mi><mi>o</mi><mi>c</mi><mi>k</mi><mi>W</mi><mi>A</mi><msub><mi>P</mi><mrow><mi>t</mi><mo>+</mo><mn>60</mn></mrow></msub></mrow><mrow><mi>S</mi><mi>t</mi><mi>o</mi><mi>c</mi><mi>k</mi><mi>W</mi><mi>A</mi><msub><mi>P</mi><mi>t</mi></msub></mrow></mfrac><mo>−</mo><mfrac><mrow><mi>I</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>x</mi><mi>W</mi><mi>A</mi><msub><mi>P</mi><mrow><mi>t</mi><mo>+</mo><mn>60</mn></mrow></msub></mrow><mrow><mi>I</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>x</mi><mi>W</mi><mi>A</mi><msub><mi>P</mi><mi>t</mi></msub></mrow></mfrac><mo fence="true">)</mo></mrow><mo>×</mo><mn>10000</mn></mrow><annotation encoding="application/x-tex">Target = \left( \frac{StockWAP_{t+60}}{StockWAP_t} - \frac{IndexWAP_{t+60}}{IndexWAP_t} \right) \times 10000</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em"></span><span class="mord mathnormal" style="margin-right:0.13889em">T</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal" style="margin-right:0.03588em">g</span><span class="mord mathnormal">e</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:2.4em;vertical-align:-0.95em"></span><span class="minner"><span class="mopen delimcenter" style="top:0em"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em"><span style="top:-2.314em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord mathnormal">St</span><span class="mord mathnormal">oc</span><span class="mord mathnormal" style="margin-right:0.13889em">kW</span><span class="mord mathnormal">A</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:0.04em"></span></span><span style="top:-3.677em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord mathnormal">St</span><span class="mord mathnormal">oc</span><span class="mord mathnormal" style="margin-right:0.13889em">kW</span><span class="mord mathnormal">A</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">60</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.836em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em"><span style="top:-2.314em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em">I</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mord mathnormal" style="margin-right:0.13889em">W</span><span class="mord mathnormal">A</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:0.04em"></span></span><span style="top:-3.677em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em">I</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mord mathnormal" style="margin-right:0.13889em">W</span><span class="mord mathnormal">A</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">60</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.836em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em"><span class="delimsizing size3">)</span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">10000</span></span></span></span></span>
<p>In other words, it is a problem of predicting the &quot;relative&quot; price change of an individual stock with the overall market movement removed.</p>
<h3 id="evaluation-metric">Evaluation Metric</h3>
<p>Mean Absolute Error (MAE):</p>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>M</mi><mi>A</mi><mi>E</mi><mo>=</mo><mfrac><mn>1</mn><mi>n</mi></mfrac><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mi mathvariant="normal">∣</mi><msub><mi>y</mi><mi>i</mi></msub><mo>−</mo><msub><mi>x</mi><mi>i</mi></msub><mi mathvariant="normal">∣</mi></mrow><annotation encoding="application/x-tex">MAE = \frac{1}{n} \sum_{i=1}^{n} |y_i - x_i|</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal" style="margin-right:0.10903em">M</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.05764em">E</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:2.9291em;vertical-align:-1.2777em"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em"><span style="top:-2.314em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord mathnormal">n</span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:0.04em"></span></span><span style="top:-3.677em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.1667em"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6514em"><span style="top:-1.8723em;margin-left:0em"><span class="pstrut" style="height:3.05em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em"><span class="pstrut" style="height:3.05em"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em"><span class="pstrut" style="height:3.05em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2777em"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord">∣</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mord">∣</span></span></span></span></span>
<h3 id="data-structure">Data Structure</h3>
<p>The training data consists of closing auction snapshots for about 200 stocks over 481 days, totaling about 5 million rows. Key columns are as follows:</p>
<table><thead><tr><th>Column</th><th>Description</th></tr></thead><tbody><tr><td><code>stock_id</code></td><td>Stock unique identifier</td></tr><tr><td><code>date_id</code></td><td>Date identifier (sequential)</td></tr><tr><td><code>seconds_in_bucket</code></td><td>Seconds elapsed since auction start</td></tr><tr><td><code>imbalance_size</code></td><td>Unmatched volume at current reference_price (USD)</td></tr><tr><td><code>imbalance_buy_sell_flag</code></td><td>Imbalance direction: 1 (Buy side), -1 (Sell side), 0 (None)</td></tr><tr><td><code>reference_price</code></td><td>Price where matched volume is maximized</td></tr><tr><td><code>matched_size</code></td><td>Volume matchable at current reference_price (USD)</td></tr><tr><td><code>far_price</code> / <code>near_price</code></td><td>Optimal execution price (Auction only / Including continuous orders)</td></tr><tr><td><code>bid_price</code> / <code>ask_price</code></td><td>Best bid/ask price in non-auction order book</td></tr><tr><td><code>bid_size</code> / <code>ask_size</code></td><td>Volume of best bid/ask (USD)</td></tr><tr><td><code>wap</code></td><td>Weighted average price of non-auction order book: <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>B</mi><mi>i</mi><mi>d</mi><mi>P</mi><mo>×</mo><mi>A</mi><mi>s</mi><mi>k</mi><mi>S</mi><mo>+</mo><mi>A</mi><mi>s</mi><mi>k</mi><mi>P</mi><mo>×</mo><mi>B</mi><mi>i</mi><mi>d</mi><mi>S</mi><mo stretchy="false">)</mo><mi mathvariant="normal">/</mi><mo stretchy="false">(</mo><mi>B</mi><mi>i</mi><mi>d</mi><mi>S</mi><mo>+</mo><mi>A</mi><mi>s</mi><mi>k</mi><mi>S</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(BidP \times AskS + AskP \times BidS) / (BidS + AskS)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05017em">B</span><span class="mord mathnormal">i</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.13889em">P</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.0833em"></span><span class="mord mathnormal">A</span><span class="mord mathnormal">s</span><span class="mord mathnormal" style="margin-right:0.03148em">k</span><span class="mord mathnormal" style="margin-right:0.05764em">S</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.0833em"></span><span class="mord mathnormal">A</span><span class="mord mathnormal">s</span><span class="mord mathnormal" style="margin-right:0.03148em">k</span><span class="mord mathnormal" style="margin-right:0.13889em">P</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal" style="margin-right:0.05017em">B</span><span class="mord mathnormal">i</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.05764em">S</span><span class="mclose">)</span><span class="mord">/</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05017em">B</span><span class="mord mathnormal">i</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.05764em">S</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal">A</span><span class="mord mathnormal">s</span><span class="mord mathnormal" style="margin-right:0.03148em">k</span><span class="mord mathnormal" style="margin-right:0.05764em">S</span><span class="mclose">)</span></span></span></span></td></tr></tbody></table>
<hr>
<h2 id="my-approach">My Approach</h2>
<h3 id="feature-engineering">Feature Engineering</h3>
<p>I used a total of 124 features in <code>my-submission.ipynb</code>. They can be broadly categorized into five groups:</p>
<p><strong>1. Liquidity/Imbalance Features</strong></p>
<ul>
<li><code>liquidity_imbalance</code>: Order volume imbalance → <code>(bid_size - ask_size) / (bid_size + ask_size)</code></li>
<li><code>matched_imbalance</code>: Matched/Imbalance volume ratio → <code>(imbalance_size - matched_size) / (imbalance_size + matched_size)</code></li>
<li><code>size_imbalance</code>: Simple ratio → <code>bid_size / ask_size</code></li>
<li><code>imbalance_momentum</code>: Time change of <code>imbalance_size</code> per stock divided by <code>matched_size</code></li>
</ul>
<p><strong>2. Price Spread Features</strong></p>
<ul>
<li><code>price_spread</code>: <code>ask_price - bid_price</code></li>
<li><code>spread_intensity</code>: Change in spread per stock</li>
<li><code>price_pressure</code>: <code>imbalance_size * price_spread</code></li>
<li><code>market_urgency</code>: <code>price_spread * liquidity_imbalance</code></li>
</ul>
<p><strong>3. Price Pair/Triplet Ratio Features</strong></p>
<ul>
<li>Imbalance ratios for all pair combinations of 6 prices (<code>reference_price</code>, <code>far_price</code>, <code>near_price</code>, <code>ask_price</code>, <code>bid_price</code>, <code>wap</code>) → <code>(P1 - P2) / (P1 + P2)</code> form</li>
<li>Numba-accelerated triplet imbalance: (max - mid) / (mid - min) ratio of three prices</li>
</ul>
<p><strong>4. Time Series Features</strong></p>
<ul>
<li>1/2/3/10 lags and pct_change for <code>matched_size</code>, <code>imbalance_size</code>, <code>reference_price</code>, <code>imbalance_buy_sell_flag</code></li>
<li>1/2/3/10 diffs for <code>ask_price</code>, <code>bid_price</code>, <code>ask_size</code>, <code>bid_size</code>, <code>market_urgency</code>, <code>imbalance_momentum</code>, <code>size_imbalance</code></li>
</ul>
<p><strong>5. Global Statistics Features</strong></p>
<ul>
<li>Median, std, ptp (peak-to-peak) of <code>bid_size</code>, <code>ask_size</code>, <code>bid_price</code>, <code>ask_price</code> per stock mapped to <code>global_*</code></li>
<li>Time derivatives: <code>dow</code> (day of week), <code>seconds</code>, <code>minute</code></li>
</ul>
<h3 id="model-and-training">Model and Training</h3>
<ul>
<li><strong>Model</strong>: LightGBM (<code>objective=&#x27;mae&#x27;</code>, <strong>Tesla P100 GPU</strong>)</li>
<li><strong>Hyperparameters</strong>: n_estimators=6000, num_leaves=256, max_depth=11, learning_rate=0.00871, subsample=0.6, colsample_bytree=0.8</li>
<li><strong>Validation</strong>: Date-based 5-fold CV, with a 5-day purge gap between folds (to prevent time leakage)</li>
<li><strong>Final Training</strong>: Retrained on full data using the average best_iteration (approx. 5103) of the 5 folds</li>
</ul>
<h3 id="inference">Inference</h3>
<ul>
<li>Mantained a rolling cache of the last 21 rows per stock to generate features</li>
<li>Equal-weight ensemble of 5 fold models</li>
<li><code>zero_sum</code> post-processing: Subtract weighted average from predictions using <strong>square root of volume (bid+ask size)</strong> as weights. This ensures the market-wide sum is zero.</li>
<li>Clipping: Limited to [-64, 64] range</li>
</ul>
<hr>
<h2 id="results">Results</h2>
<table><thead><tr><th>Item</th><th>Value</th></tr></thead><tbody><tr><td>5-fold CV MAE</td><td>5.83 (Per fold: 6.75, 6.12, 5.97, 5.49, 4.80)</td></tr><tr><td>Public/Private LB</td><td>5.4744</td></tr><tr><td>Rank</td><td>981st / 3,225 Teams (Top 30%)</td></tr><tr><td>Runtime</td><td>2h 35m (P100 GPU)</td></tr><tr><td>Inference Speed</td><td>~0.34s per batch</td></tr></tbody></table>
<hr>
<h2 id="comparison-with-top-solutions">Comparison with Top Solutions</h2>
<p>After the competition, I reviewed top solutions to see what I missed.</p>
<h3 id="1st-place--hyd-hydantess">1st Place – HYD (hydantess)</h3>
<ul>
<li><strong>Model</strong>: CatBoost(50%) + GRU(30%) + Transformer(20%) Ensemble</li>
<li><strong>Features</strong>: GRU captured 55-step time-series patterns, Transformer captured cross-sectional relationships among 200 stocks</li>
<li><strong>Online Learning</strong>: Retrained every 12 days (Total 4 times)</li>
<li><strong>Weighted zero_sum</strong>: <code>pred -= (pred * stock_weights).sum() / stock_weights.sum()</code></li>
<li><strong>Sample Weights</strong>: Normalized per-stock volatility with <code>1.0 / (stock_std + 1e-7)</code></li>
</ul>
<h3 id="9th-place--adam-hookman">9th Place – ADAM. (hookman)</h3>
<ul>
<li><strong>Model</strong>: 3× XGBoost (different seeds)</li>
<li><strong>Features</strong>: 157 features, median-scaled volume, MACD, WAP-based target proxy</li>
<li><strong>Data Weights</strong>: 1.5x weight on last 45 days</li>
<li><strong>Online Learning</strong>: Retrained on Day N and Day N+30</li>
</ul>
<h3 id="14th-place--clash-royale-5-person-team">14th Place – Clash Royale (5-person team)</h3>
<ul>
<li><strong>Model</strong>: LightGBM + CatBoost simple average</li>
<li><strong>Features</strong>: 193 features, revealed target lags, RSI/MACD/Bollinger Bands</li>
<li><strong>Online Learning</strong>: Alternating LGB/CAT retraining every 6-9 days</li>
<li><strong>Key Fix</strong>: Fixed leakage in <code>mid_price_movement</code> calculation by grouping by <code>stock_id</code></li>
</ul>
<h3 id="15th-place--o-yuksel-lognorm">15th Place – O Yuksel (lognorm)</h3>
<ul>
<li><strong>Model</strong>: 3× LGB (Offline) + 4× XGB + 1× LGB (Online)</li>
<li><strong>Features</strong>: Revealed target, relative performance vs. market/sector, behavior-based embeddings instead of stock_id</li>
<li><strong>Post-processing</strong>: Subtracted index-weighted mean instead of simple zero-sum</li>
</ul>
<h3 id="common-themes-and-what-i-missed">Common Themes and What I Missed</h3>
<table><thead><tr><th>Top Solution Feature</th><th>My Solution</th></tr></thead><tbody><tr><td><strong>Online Learning</strong> (Retrain every 6~30 days)</td><td>Trained once and fixed</td></tr><tr><td><strong>Multi-Model Ensemble</strong> (LGB+CAT+XGB or +GRU/Transformer)</td><td>LightGBM Single</td></tr><tr><td><strong>Per-Stock Scaling</strong> (stock_std, median)</td><td>used Global statistics only</td></tr><tr><td><strong>Weighted zero_sum</strong></td><td>Used simple volume sqrt weights</td></tr><tr><td><strong>Revealed Target Features</strong></td><td>Not used</td></tr><tr><td><strong>Seed Diversity</strong> (3+ same models)</td><td>5-fold ensemble only</td></tr></tbody></table>
<hr>
<h2 id="retrospective">Retrospective</h2>
<h3 id="what-went-well">What Went Well</h3>
<ul>
<li>Accelerated triplet imbalance calculation with Numba to reduce feature generation time</li>
<li>Prevented time leakage with date-based purge gap</li>
<li>Ran stably in Kaggle environment thanks to memory downcasting</li>
</ul>
<h3 id="what-could-be-improved">What Could Be Improved</h3>
<ul>
<li><strong>Did not use Online Learning.</strong> The competition API provided the <strong>previous day&#x27;s target (<code>revealed_targets</code>)</strong> at the start of each day. Top rankers did not discard this data but periodically retrained models to reflect the latest market trends. I trained the model once and left it for 3 months, failing to adapt to drift.</li>
<li><strong>Did not use Sequence Models.</strong> The 1st place solution used GRU for temporal order and Transformer for cross-stock relationships. Tree models alone likely struggled to capture these structural patterns.</li>
<li><strong>Lack of Per-Stock Normalization.</strong> Scaling by stock_std or median could have corrected for volatility differences between stocks.</li>
<li><strong>Persistence:</strong> Since this project was for completing the Google ML Bootcamp, I didn&#x27;t persist until the very end of the competition. I wonder if I could have gotten a higher score if I had put in a bit more effort.</li>
</ul>
<hr>
<h2 id="references">References</h2>
<ul>
<li><a href="https://www.kaggle.com/competitions/optiver-trading-at-the-close/writeups/hyd-1st-place-solution">1st place – HYD</a></li>
<li><a href="https://www.kaggle.com/competitions/optiver-trading-at-the-close/writeups/adam-9th-place-solution">9th place – ADAM.</a></li>
<li><a href="https://www.kaggle.com/competitions/optiver-trading-at-the-close/writeups/clash-royale-14th-place-solution-for-the-optiver-t">14th place – Clash Royale</a></li>
<li><a href="https://www.kaggle.com/competitions/optiver-trading-at-the-close/writeups/o-yuksel-15th-place-solution">15th place – O Yuksel</a></li>
<li><a href="https://www.kaggle.com/competitions/optiver-trading-at-the-close/data">Kaggle Data Page</a></li>
</ul></div></div></div></div>
</body>
</html>